---
import Layout from '../../layouts/Layout.astro';
import WhatsAppBtn from '../../components/WhatsAppBtn.astro';
import { Badge } from '../../components/ui/badge';
import { tours } from '../../data/tours';
import { Clock, Signal, CheckCircle2 } from 'lucide-react';
import TourCarousel from '../../components/TourCarousel.tsx';

export async function getStaticPaths() {
  return tours.map((tour) => ({
    params: { slug: tour.slug },
    props: { tour },
  }));
}

const { tour } = Astro.props;

const schema = {
  "@context": "https://schema.org",
  "@type": "TouristTrip",
  "name": tour.title,
  "description": tour.description,
  "image": tour.image,
  "touristType": [
    "AdventureTourism",
    "NatureTourism"
  ],
  "itinerary": {
    "@type": "ItemList",
    "itemListElement": tour.highlights.map((highlight, index) => ({
      "@type": "ListItem",
      "position": index + 1,
      "name": highlight
    }))
  },
  "offers": {
    "@type": "Offer",
    "price": tour.price,
    "priceCurrency": "USD",
    "availability": "https://schema.org/InStock",
    "url": `https://chuchi-adventures.com/tours/${tour.slug}`
  },
  "provider": {
    "@type": "LocalBusiness",
  "name": "BeyondArenal",
  "image": "https://chuchi-adventures.com/logo.png",
    "telephone": "+50684291847",
    "address": {
      "@type": "PostalAddress",
      "addressLocality": "Pe√±as Blancas",
      "addressRegion": "Alajuela",
      "addressCountry": "CR"
    }
  }
};
---

<script type="application/ld+json" set:html={JSON.stringify(schema)} />

<Layout title={tour.title} description={tour.description} image={tour.image}>
  <!-- Hero with Image -->
  <div class="relative h-[60vh] md:h-[70vh] overflow-hidden group">
    <img 
      src={tour.image} 
      alt={tour.title}
      class="w-full h-full object-cover transform group-hover:scale-105 transition-transform duration-[2s]"
    />
    <div class="absolute inset-0 bg-gradient-to-t from-slate-900 via-slate-900/40 to-transparent"></div>
    
    <div class="absolute bottom-0 left-0 right-0 p-8 md:p-16 text-white container-custom">
      <div class="flex flex-wrap gap-3 mb-6 animate-fade-in">
        <span class="inline-flex items-center px-3 py-1 rounded-full bg-[var(--color-primary)] text-sm font-bold backdrop-blur-sm border border-white/20">
          <Clock className="w-4 h-4 mr-2" />
          {tour.duration}
        </span>
        <span class="inline-flex items-center px-3 py-1 rounded-full bg-white/20 text-sm font-bold backdrop-blur-sm border border-white/20">
          <Signal className="w-4 h-4 mr-2" />
          {tour.difficulty}
        </span>
         <span class="inline-flex items-center px-3 py-1 rounded-full bg-white/20 text-sm font-bold backdrop-blur-sm border border-white/20 uppercase tracking-widest">
          {tour.category}
        </span>
      </div>
      
      <h1 class="text-4xl md:text-6xl font-bold mb-6 drop-shadow-xl leading-tight max-w-4xl">
        {tour.title}
      </h1>
      
      <div class="flex items-baseline gap-2">
         <span class="text-3xl md:text-4xl font-bold text-[var(--color-secondary)]">${tour.price}</span>
         <span class="text-lg text-gray-300">/ per person</span>
      </div>
    </div>
  </div>

   <div class="container-custom py-16 md:py-24">
     <div class="grid grid-cols-1 lg:grid-cols-3 gap-16">
       
       <!-- Main Content -->
       <div class="lg:col-span-2 space-y-16">
         
         
         <!-- Premium Photo Gallery -->
         <TourCarousel 
           images={tour.images || [tour.image]} 
           title={tour.title}
           className="py-8"
         />
         
         <section>
           <h2 class="text-3xl font-bold mb-6 text-slate-900">Adventure Description</h2>
           <p class="text-slate-600 text-lg leading-loose">
             {tour.description}
           </p>
         </section>

        <section>
          <h2 class="text-3xl font-bold mb-8 text-slate-900">What's Included</h2>
          <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
            {tour.highlights.map((item) => (
              <div class="flex items-center p-4 rounded-xl bg-slate-50 border border-slate-100 hover:border-[var(--color-secondary)] transition-colors">
                <div class="bg-green-100 p-2 rounded-full mr-4 text-green-600">
                  <CheckCircle2 className="w-5 h-5" />
                </div>
                <span class="text-slate-700 font-medium">{item}</span>
              </div>
            ))}
          </div>
        </section>

        <section>
          <h2 class="text-3xl font-bold mb-6 text-slate-900">What to Bring?</h2>
          <ul class="list-none space-y-3">
             <li class="flex items-center text-slate-600">
               <span class="w-2 h-2 bg-[var(--color-primary)] rounded-full mr-4"></span>
               Comfortable clothes and change of clothes
             </li>
             <li class="flex items-center text-slate-600">
               <span class="w-2 h-2 bg-[var(--color-primary)] rounded-full mr-4"></span>
               Water shoes or hiking boots
             </li>
             <li class="flex items-center text-slate-600">
               <span class="w-2 h-2 bg-[var(--color-primary)] rounded-full mr-4"></span>
               Sunscreen and insect repellent
             </li>
             <li class="flex items-center text-slate-600">
               <span class="w-2 h-2 bg-[var(--color-primary)] rounded-full mr-4"></span>
               Camera or GoPro
             </li>
          </ul>
        </section>
      </div>

      <!-- Sidebar / Sticky CTA -->
      <div class="lg:col-span-1">
        <div class="bg-white p-8 rounded-3xl shadow-2xl sticky top-28 border border-slate-100">
          <div class="mb-8">
            <span class="text-slate-500 uppercase tracking-wider text-sm font-semibold">Total Price</span>
            <div class="flex items-baseline mt-1">
               <span class="text-4xl font-bold text-slate-900">${tour.price}</span>
               <span class="text-slate-500 ml-2">USD</span>
            </div>
          </div>
        
          <h3 class="text-xl font-bold mb-4 text-slate-900">Book this adventure</h3>
          <p class="text-slate-500 mb-8 text-sm leading-relaxed">
            To guarantee the best experience and availability, we handle reservations directly via WhatsApp. No advanced payments!
          </p>
          
          <WhatsAppBtn 
            text="Check Availability" 
            message={`Hello, I am interested in the tour: ${tour.title}. Is there space available?`}
            className="w-full justify-center bg-[var(--color-primary)] hover:bg-[var(--color-primary-dark)] text-white text-lg py-4 rounded-xl shadow-lg hover:shadow-xl transform hover:-translate-y-1 transition-all mb-4 font-bold" 
          />
          
          <div class="flex items-center justify-center gap-2 text-xs text-slate-400 mt-4">
             <div class="w-2 h-2 bg-green-500 rounded-full animate-pulse"></div>
            Immediate response during business hours
          </div>
        </div>
      </div>
    </div>
  </div>
</Layout>
